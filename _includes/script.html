<script type="text/javascript">
    (function(){
            const sideMenu = document.querySelector('#sideMenu');
            const toggleSideMenuButtons = document.querySelectorAll('.toggle-side-menu');
            const main = document.querySelector('#main');

            function toggleSideMenu() {
                let state = JSON.parse(sessionStorage.getItem('sideMenuState'));

                sideMenu.classList.toggle('is-in');
                main.classList.toggle('ml-0');
                main.classList.toggle('unit-12');

                if (!state)
                    state = {};

                if (sideMenu.classList.contains('is-in'))
                    state.isIn = true;
                else
                    state.isIn = false;

               sessionStorage.setItem('sideMenuState', JSON.stringify(state));
            }

            function setActiveTabs() {
                const nestedTabLists = sideMenu.querySelectorAll('.tab-a + ul');
                const state = JSON.parse(sessionStorage.getItem('sideMenuState'));

                for (let index = 0; index < nestedTabLists.length; index++) {
                    let tabA = nestedTabLists[index].previousElementSibling;

                    if (state && state.parentTabsOpen && state.parentTabsOpen.includes(tabA.innerText.toLowerCase()))
                        nestedTabLists[index].classList.remove('absent');
                }
            }

            function handleSideMenuClick(e) {
                const target = e.target;
                const sibling = target.nextElementSibling;
                let state = JSON.parse(sessionStorage.getItem('sideMenuState'));

                if (target.classList.contains('tab-a') && sibling) {
                    e.preventDefault();
                    sibling.classList.toggle('absent');

                    if (!state)
                        state = {};

                    if (!state.parentTabsOpen)
                        state.parentTabsOpen = [];

                    if (sibling.classList.contains('absent') && state.parentTabsOpen && state.parentTabsOpen.includes(e.target.innerText.toLowerCase())) {
                        const index = state.parentTabsOpen.indexOf(e.target.innerText.toLowerCase());

                        state.parentTabsOpen.splice(index, 1);
                    }
                    else if (!sibling.classList.contains('absent') && state.parentTabsOpen && !state.parentTabsOpen.includes(e.target.innerText.toLowerCase())) {
                        state.parentTabsOpen.push(e.target.innerText.toLowerCase());
                    }

                    sessionStorage.setItem('sideMenuState', JSON.stringify(state));
                }

            }

            function initializePage() {
                let state = JSON.parse(sessionStorage.getItem('sideMenuState'));

                if (state && state.hasOwnProperty('isIn') && !state.isIn)
                    toggleSideMenu();

                setActiveTabs();
            }

            toggleSideMenuButtons.forEach(function(element) {
                element.addEventListener('click', toggleSideMenu);
            });

            sideMenu.addEventListener('click', handleSideMenuClick);

            initializePage();
    })();
</script>